<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pulque Vivo ‚Äî Pulque ¬∑ Tierra ¬∑ Maguey</title>
  <meta name="description" content="Pulque, tierra y maguey: art√≠culos, gu√≠as y proyectos con dise√±o moderno y animado." />
  <style>
    /* ===== Reset + tokens ===== */
    *,*::before,*::after{box-sizing:border-box}
    body{
      margin:0;
      overflow-x:hidden;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,'Helvetica Neue',Arial,'Apple Color Emoji','Segoe UI Emoji';
      line-height:1.5;
      color:#0f172a;
      background:#f6f8fb;
    }
    :root{
      --brand:#059669;
      --ink:#0f172a;
      --muted:#475569;
      --card:#ffffff;
      --stroke:#e5e7eb;
    }
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}

    .container{max-width:1180px;margin-inline:auto;padding:0 16px}
    @media (min-width:640px){ .container{padding:0 24px} }
    .stack-2{display:grid;gap:.5rem}
    .stack-3{display:grid;gap:.75rem}
    .stack-4{display:grid;gap:1rem}
    .stack-6{display:grid;gap:1.5rem}

    /* ===== NAV ===== */
    .nav{
      position:sticky;top:0;z-index:50;
      background:transparent;
      border-bottom:1px solid transparent;
      backdrop-filter:saturate(180%) blur(14px);
      transition:background .25s ease,border-color .25s ease,box-shadow .25s ease;
    }
    .nav .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 0;
      gap:1rem;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:.5rem;
      font-weight:700;
    }
    .brand-logo{
      height:44px;
      width:auto;
      display:block;
    }
    @media (min-width:768px){
      .brand-logo{height:58px;}
    }
    .brand-text{
      font-size:1rem;
      color:#111827;
      letter-spacing:.02em;
    }

    .links{
      display:flex;
      align-items:center;
      gap:.5rem;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:.45rem;
      padding:.5rem .9rem;
      border:2px solid var(--brand);
      color:var(--brand);
      background:rgba(255,255,255,.98);
      border-radius:999px;
      font-weight:700;
      font-size:.8rem;
      cursor:pointer;
      white-space:nowrap;
      transition:background .18s ease,color .18s ease,transform .12s ease,border-color .18s ease;
      position:relative;
      z-index:55;
    }
    .chip .emoji{font-size:1rem}
    .chip:hover{
      background:var(--brand);
      color:#020817;
      transform:translateY(-1px);
    }

    /* ===== Comunidad con dropdown ===== */
    .chip-dropdown{
      padding-right:1.6rem;
      user-select:none;
      transform:none !important; /* sin brinco */
    }
    .chip-dropdown::after{
      content:'';
      position:absolute;
      right:.6rem;
      top:50%;
      width:0;
      height:0;
      border-left:4px solid transparent;
      border-right:4px solid transparent;
      border-top:5px solid var(--brand);
      transform:translateY(-40%);
      pointer-events:none;
    }
    .chip-dropdown .dropdown{
      position:absolute;
      top:100%;
      right:0;           /* abre hacia la izquierda para no salirte */
      left:auto;
      margin-top:-1px;   /* se monta 1px, sin hueco */
      background:#020817;
      border-radius:16px;
      padding:.35rem 0;
      border:1px solid rgba(34,197,94,.35);
      box-shadow:0 18px 40px rgba(0,0,0,.45);
      display:none;
      min-width:220px;
      max-width:260px;
      z-index:60;
    }
    .chip-dropdown .dropdown a,
    .chip-dropdown .dropdown .item > a{
      display:flex;
      align-items:center;
      gap:.35rem;
      padding:.45rem .9rem;
      font-size:.78rem;
      color:#bbf7d0;
      text-decoration:none;
    }
    .chip-dropdown .dropdown a span,
    .chip-dropdown .dropdown .item > a span{
      font-size:.9rem;
    }
    .chip-dropdown .dropdown a:hover,
    .chip-dropdown .dropdown .item > a:hover{
      background:rgba(34,197,94,.16);
      color:#22c55e;
    }

    .chip-dropdown .dropdown .item{
      position:relative;
    }
    .chip-dropdown .dropdown .item-label{
      display:flex;
      align-items:center;
      gap:.35rem;
      padding:.45rem .9rem;
      font-size:.78rem;
      color:#bbf7d0;
      cursor:pointer;
    }
    .chip-dropdown .dropdown .item-label span.icon{
      font-size:.9rem;
    }
    .chip-dropdown .dropdown .item-label span.caret{
      margin-left:auto;
      font-size:.6rem;
      opacity:.8;
    }
    .chip-dropdown .dropdown .item-label:hover{
      background:rgba(34,197,94,.16);
      color:#22c55e;
    }

    /* Submen√∫ abre hacia la izquierda para evitar scroll horizontal */
    .chip-dropdown .dropdown .submenu{
      position:absolute;
      top:0;
      right:100%;
      left:auto;
      margin-right:-1px;
      background:#020817;
      border-radius:14px;
      padding:.3rem 0;
      border:1px solid rgba(34,197,94,.35);
      box-shadow:0 18px 40px rgba(0,0,0,.6);
      display:none;
      min-width:170px;
      z-index:70;
    }
    .chip-dropdown .dropdown .submenu a{
      padding:.4rem .75rem;
      font-size:.76rem;
      color:#bbf7d0;
    }
    .chip-dropdown .dropdown .submenu a:hover{
      background:rgba(34,197,94,.18);
      color:#22c55e;
    }

    .chip-dropdown:hover,
    .chip-dropdown:focus-within{
      background:var(--brand);
      color:#020817;
    }
    .chip-dropdown:hover::after,
    .chip-dropdown:focus-within::after{
      border-top-color:#020817;
    }
    .chip-dropdown:hover .dropdown,
    .chip-dropdown:focus-within .dropdown{
      display:block;
    }
    .chip-dropdown .dropdown .item:hover .submenu,
    .chip-dropdown .dropdown .item:focus-within .submenu{
      display:block;
    }

    /* NAV cuando hay scroll */
    .nav.scrolled{
      background:#020817;
      border-bottom-color:rgba(148,163,253,.18);
      box-shadow:0 14px 40px rgba(0,0,0,.55);
    }
    .nav.scrolled .brand-text{color:#f9fafb;}
    .nav.scrolled .chip{
      background:transparent;
      border-color:#22c55e;
      color:#bbf7d0;
      transform:none;
    }
    .nav.scrolled .chip:hover{
      background:#22c55e;
      color:#020817;
    }
    .nav.scrolled .chip-dropdown::after{
      border-top-color:#22c55e;
    }

    /* ===== HERO ===== */
    .hero{position:relative}
    .hero--compact{padding:44px 0 32px}
    .hero-wrap{display:grid;gap:1.25rem}
    @media (min-width:900px){
      .hero-wrap{grid-template-columns:1.1fr .9fr;align-items:center}
    }
    .hero-title{
      margin:0;
      font-size:clamp(30px,7vw,64px);
      line-height:1.06;
      letter-spacing:-.5px;
      background:linear-gradient(135deg,#059669,#65a30d,#065f46);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    .hero-subtitle{
      margin:.35rem 0 0;
      color:#475569;
      max-width:60ch;
      font-size:clamp(15px,3.8vw,18px);
    }
    .hero-chips{
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
      margin:.8rem 0 0;
    }
    .pill{
      display:inline-flex;
      gap:.5rem;
      align-items:center;
      padding:.45rem .75rem;
      border-radius:14px;
      background:rgba(16,185,129,.12);
      color:#065f46;
      font-weight:700;
    }
    .cta-group{
      display:grid;
      gap:.6rem;
      margin-top:.9rem;
    }
    @media (min-width:520px){
      .cta-group{grid-auto-flow:column;justify-content:start}
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.5rem;
      border:0;
      border-radius:16px;
      padding:.65rem 1rem;
      font-weight:700;
      cursor:pointer;
      transition:transform .12s ease,filter .18s ease,box-shadow .18s ease;
    }
    .btn-brand{
      background:var(--brand);
      color:#fff;
      box-shadow:0 10px 30px rgba(16,185,129,.35);
    }
    .btn-brand:hover{
      filter:brightness(.96);
      transform:translateY(-1px);
    }
    .btn-block{width:100%}
    @media (min-width:520px){.btn-block{width:auto}}

    .hero-side{display:none}
    @media (min-width:900px){.hero-side{display:block}}
    .hero-card{padding:20px;position:relative;overflow:hidden}
    .hero-card-bloom{
      position:absolute;inset:auto -80px auto auto;
      width:220px;height:220px;border-radius:999px;
      background:rgba(16,185,129,.18);filter:blur(40px)
    }
    .hero-card-text{color:#475569;margin:0}
    .hero-mini-cards{
      display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.25rem
    }
    .hero-mini-cards .mini{
      padding:.55rem .9rem;border-radius:12px;
      box-shadow:none;background:rgba(255,255,255,.9);
    }

    /* Backdrop blobs */
    .backdrop{position:absolute;inset:0;overflow:hidden;z-index:-1}
    .blob{position:absolute;border-radius:999px;filter:blur(40px);opacity:.35;transform:translateZ(0);animation:float 18s ease-in-out infinite}
    .b1{width:580px;height:580px;left:-120px;top:-120px;background:radial-gradient(closest-side,#34d399,transparent)}
    .b2{width:480px;height:480px;right:-120px;top:120px;background:radial-gradient(closest-side,#22d3ee,transparent);animation-delay:2s}
    .b3{width:360px;height:360px;left:40%;bottom:-120px;background:radial-gradient(closest-side,#a3e635,transparent);animation-delay:4s}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-24px)}}

    /* ===== POSTS ===== */
    .posts-grid{display:grid;grid-template-columns:1fr;gap:1rem}
    @media (min-width:640px){.posts-grid{grid-template-columns:repeat(2,1fr)}}
    @media (min-width:980px){.posts-grid{grid-template-columns:repeat(3,1fr)}}
    .card{
      border-radius:24px;
      background:rgba(255,255,255,.9);
      border:1px solid rgba(15,23,42,.06);
      box-shadow:0 20px 50px -12px rgba(0,0,0,.15);
      overflow:hidden;
    }
    .post-cover{
      height:144px;
      background:linear-gradient(135deg,rgba(16,185,129,.15),rgba(250,204,21,.15));
    }

    /* ===== DONAR ===== */
    .don-grid{display:grid;gap:1rem}
    @media (min-width:760px){.don-grid{grid-template-columns:1.1fr .9fr}}
    .copy-badge{
      display:inline-flex;gap:.5rem;align-items:center;
      padding:.4rem .7rem;border:1px dashed rgba(15,23,42,.25);
      border-radius:12px;font-weight:700;flex-wrap:wrap;
    }

    /* ===== BIO / TEOMATI ===== */
    .bio-card{padding:24px}
    .bio-title{margin:0}
    .bio-text{color:#64748b;margin:.4rem 0 0}

    /* ===== FOOTER & REVEAL ===== */
    footer{
      border-top:1px solid rgba(15,23,42,.08);
      padding:24px 0;
      margin-top:40px;
      color:#64748b;
    }
    .reveal{opacity:0;transform:translateY(16px);transition:opacity .5s ease,transform .5s ease}
    .reveal.in{opacity:1;transform:translateY(0)}
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav" id="mainNav">
    <div class="container row">
      <a class="brand" href="index.html">
        <img src="images/logo_transparente.png" alt="Guardianes del Pulque" class="brand-logo">
        <span class="brand-text">Guardianes del Pulque</span>
      </a>
      <div class="links">
        <!-- Comunidad primero -->
        <div class="chip chip-dropdown">
          Comunidad
          <div class="dropdown">
            <div class="item">
              <div class="item-label">
                <span class="icon">üíº</span> Patrocinadores
                <span class="caret">‚ñ∏</span>
              </div>
              <div class="submenu">
                <a href="https://teomatisacredcopal.com/" target="_blank" rel="noopener">Teomati</a>
              </div>
            </div>
            <a href="alianzas.html">
              <span>ü§ù</span> Aliados
            </a>
            <a href="colabora.html">
              <span>‚ú®</span> Quiero colaborar
            </a>
          </div>
        </div>

        <a class="chip" href="posts.html">Art√≠culos</a>
        <a class="chip" href="#donar"><span class="emoji">üíö</span> Donar</a>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <header class="hero hero--compact container">
    <div class="backdrop" aria-hidden="true">
      <div class="blob b1"></div><div class="blob b2"></div><div class="blob b3"></div>
    </div>

    <div class="hero-wrap">
      <div class="stack-4 reveal">
        <h1 class="hero-title">Pulque ¬∑ Tierra ¬∑ Maguey</h1>
        <p class="hero-subtitle">Historias, gu√≠as y proyectos para cultivar, construir y cuidar el territorio.</p>
        <div class="hero-chips">
          <span class="pill">üç∂ Pulque vivo</span>
          <span class="pill">üèóÔ∏è Tierra que construye</span>
          <span class="pill">üåµ Maguey y paisaje</span>
        </div>
        <div class="cta-group">
          <a class="btn btn-brand btn-block" href="#posts">Explorar art√≠culos ‚Üí</a>
        </div>
        <small style="color:#64748b;display:block;margin-top:.25rem">‚Ä¢ Actualizado cada semana</small>
      </div>

      <div class="hero-side reveal">
        <div class="card hero-card">
          <div class="hero-card-bloom"></div>
          <div class="stack-3">
            <div class="pill">üçÉ <strong>Guardianes del pulque</strong></div>
            <p class="hero-card-text">Microbiota, magueyes, oficios y barro que dialogan con tecnolog√≠as abiertas.</p>
            <div class="hero-mini-cards">
              <div class="mini card">Fermentos</div>
              <div class="mini card">Adobe</div>
              <div class="mini card">Humedales</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- POSTS HOME -->
  <section id="posts" class="container" style="margin-bottom:48px">
    <div class="stack-2" style="grid-auto-flow:column;justify-content:space-between;align-items:end;margin-bottom:12px">
      <h2 style="margin:0">Art√≠culos recientes</h2>
      <a class="chip" href="posts.html">Ver todo</a>
    </div>
    <div class="posts-grid" id="postsGrid"></div>
    <div id="status" style="margin-top:8px;font-size:12px;color:#64748b"></div>
  </section>

  <!-- DONAR -->
  <section id="donar" class="container" style="margin-bottom:64px">
    <div class="card reveal" style="padding:24px">
      <div class="stack-3">
        <h3 style="margin:0"><span class="emoji">üíö</span> Donar</h3>
        <p style="color:#64748b;margin:0">
          Tu apoyo mantiene contenidos abiertos sobre pulque, tierra y maguey. Gracias por impulsar este trabajo comunitario.
        </p>

        <div class="don-grid">
          <div class="stack-3">
            <div class="copy-badge">
              <span>CLABE:</span>
              <code id="clabeText">012 180 01568369912 6</code>
              <button id="copyClabe" class="btn" type="button">Copiar</button>
            </div>
            <small style="color:#94a3b8">BBVA</small>

           <div class="stack-2" style="grid-auto-flow:column;gap:.5rem;align-items:center;justify-content:flex-start">
                <a id="paypalBtn" class="chip"
                     href="https://paypal.me/delagarzac?locale.x=es_XC&amp;country.x=MX"
                     target="_blank" rel="noopener">
                    <span class="emoji">üíö</span> Donar por PayPal
                </a>
                <a class="chip" href="mailto:donaciones@tusitio.mx">Otra forma de donar</a>
          </div>

          </div>

          <div class="stack-3">
            <div class="card" style="padding:16px;background:rgba(16,185,129,.08)">
              <strong>Transparencia</strong>
              <p style="color:#64748b;margin:.4rem 0 0">
                Publicaremos un resumen de en qu√© se invierte: servidores, materiales, talleres y trabajo comunitario.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- TEOMATI -->
  <section id="bioalkimia" class="container" style="margin-bottom:64px">
    <div class="card bio-card reveal">
      <h3 class="bio-title">Teomati</h3>
      <p class="bio-text">
        Proyecto hermano donde convergen bioconstrucci√≥n, fermentos y territorio. Visita para conocer m√°s colaboraciones.
      </p>
      <div class="stack-2" style="grid-auto-flow:column;gap:.5rem;align-items:center;justify-content:flex-start;margin-top:.5rem">
        <a class="chip" href="https://teomatisacredcopal.com/" target="_blank" rel="noopener">Ir a Teomati ‚Üí</a>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="container" style="display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap">
      <div style="display:flex;align-items:center;gap:.5rem">
        <img src="images/logo_transparente.png" alt="Guardianes del Pulque" style="height:26px;width:auto">
        <span>Guardianes del Pulque</span>
      </div>
      <div class="links">
        <a class="chip" href="posts.html">Art√≠culos</a>
        <a class="chip" href="#donar"><span class="emoji">üíö</span> Donar</a>
        <a class="chip" href="#bioalkimia">Teomati</a>
      </div>
    </div>
  </footer>

  <!-- Fallback posts -->
  <script type="application/json" id="posts-fallback">[
    {
      "tag":"Pulque",
      "title":"De la penca al jarro: el proceso vivo",
      "excerpt":"Fermentos, microbiota y tradici√≥n del maguey paso a paso.",
      "url":"articulos/delapencaaljarro/de-la-penca-al-jarro.html",
      "cover":"articulos/delapencaaljarro/de_la_penca_al_jarro.png"
    }
  ]</script>

  <script>
    (function(){
      const nav = document.getElementById('mainNav');
      if(!nav) return;
      function update(){
        if(window.scrollY > 10) nav.classList.add('scrolled');
        else nav.classList.remove('scrolled');
      }
      update();
      window.addEventListener('scroll', update, {passive:true});
    })();

    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.classList.add('in');
          io.unobserve(e.target);
        }
      });
    }, {threshold:.2});
    document.querySelectorAll('.reveal').forEach(el=>io.observe(el));

    function escapeHtml(s){
      return String(s).replace(/[&<>"]/g, m => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'
      }[m]));
    }

    const HOMEPAGE_LIMIT = 6;

    function candidateUrls(filename){
      const ts = Date.now();
      const origin = location.origin;
      const path = location.pathname;
      const dir = path.replace(/[^\/]*$/,'');
      const segs = path.split('/').filter(Boolean);
      const repoBase = segs.length ? `/${segs[0]}/` : '/';
      return [
        `${origin}${dir}${filename}?v=${ts}`,
        `${origin}${repoBase}${filename}?v=${ts}`,
        `${origin}/${filename}?v=${ts}`
      ].filter((v,i,a)=>a.indexOf(v)===i);
    }

    async function fetchJsonSmart(filename){
      const tries = candidateUrls(filename);
      const status = document.getElementById('status');
      const traces = [];
      for(const url of tries){
        try{
          const r = await fetch(url,{cache:'no-store'});
          traces.push(`GET ${url} ‚Üí ${r.status}`);
          if(r.ok) return await r.json();
        }catch(e){
          traces.push(`ERR ${url} ‚Üí ${e}`);
        }
      }
      if(status){
        status.textContent = (location.protocol === 'file:'
          ? 'Abre con Live Server (fetch se bloquea con file://).'
          : 'No se encontr√≥ posts.json. Col√≥calo junto a index.html en GitHub Pages.');
      }
      console.warn('posts.json no encontrado:\n'+traces.join('\n'));
      throw new Error('posts.json no encontrado');
    }

    async function loadPosts(){
      let posts = [];
      try{
        const data = await fetchJsonSmart('posts.json');
        posts = Array.isArray(data) ? data : (Array.isArray(data.entries) ? data.entries : []);
      }catch(_){}
      if(!posts.length){
        try{
          posts = JSON.parse(document.getElementById('posts-fallback').textContent || '[]');
        }catch{}
      }
      renderPosts(posts.slice(0, HOMEPAGE_LIMIT));
    }

    function renderPosts(items){
      const grid = document.getElementById('postsGrid');
      grid.innerHTML = '';
      if(!items.length){
        grid.innerHTML = '<p class="muted">A√∫n no hay art√≠culos.</p>';
        return;
      }
      items.forEach(p=>{
        const card = document.createElement('article');
        card.className = 'card reveal';
        card.style.overflow = 'hidden';

        const coverStyle = p.cover
          ? `style="background-image:url('${p.cover}');background-size:cover;background-position:center"`
          : '';

        card.innerHTML = `
          <div class="post-cover" ${coverStyle}></div>
          <div style="padding:16px">
            <div style="font-size:12px;color:var(--brand)">${escapeHtml(p.tag || '')}</div>
            <h3 style="margin:.2rem 0;font-size:1rem">${escapeHtml(p.title || '')}</h3>
            <p style="color:#475569">${escapeHtml(p.excerpt || '')}</p>
            <div style="padding-top:6px">
              <a class="chip" href="${p.url || '#'}">Leer ‚Üí</a>
            </div>
          </div>
        `;
        grid.appendChild(card);
        io.observe(card);
      });
    }

    document.getElementById('copyClabe').addEventListener('click', async ()=>{
      const t = document.getElementById('clabeText').textContent.trim();
      try{
        await navigator.clipboard.writeText(t);
        alert('CLABE copiada');
      }catch{
        alert('Copia la CLABE manualmente');
      }
    });

    document.getElementById('paypalBtn').href = "#";

    loadPosts();
  </script>
</body>
</html>
