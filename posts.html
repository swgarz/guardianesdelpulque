<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Todos los artÃ­culos â€” Guardianes del Pulque</title>
  <meta name="description" content="Listado completo de artÃ­culos: pulque, tierra y maguey." />
  <style>
    *,*::before,*::after{box-sizing:border-box}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,'Helvetica Neue',Arial,'Apple Color Emoji','Segoe UI Emoji';
      line-height:1.5;
      color:#0f172a;
      background:#f6f8fb;
      transition:background .25s ease,color .25s ease;
    }
    :root{ --brand:#059669; --ink:#0f172a; --muted:#475569; --card:#ffffff; --stroke:#e5e7eb; }
    a{color:inherit;text-decoration:none}

    .container{max-width:1180px;margin-inline:auto;padding:0 16px}
    @media (min-width:640px){ .container{padding:0 24px} }

    /* NAV (igual que index para consistencia) */
    .nav{
      position:sticky;top:0;z-index:80;
      background:rgba(255,255,255,.96);
      backdrop-filter:saturate(180%) blur(14px);
      border-bottom:1px solid rgba(15,23,42,.06);
    }
    .nav .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:8px 0;
      gap:.75rem;
      flex-wrap:wrap;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:.45rem;
      font-weight:700;
      flex-shrink:0;
    }
    .brand-logo{height:40px;width:auto}
    @media (min-width:768px){.brand-logo{height:52px}}
    .brand-text{
      font-size:.98rem;
      color:#111827;
      letter-spacing:.01em;
    }
    .links{
      display:flex;
      align-items:center;
      gap:.35rem;
      flex-wrap:wrap;
      justify-content:flex-end;
      flex:1;
      min-width:0;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      padding:.4rem .8rem;
      border:2px solid var(--brand);
      color:var(--brand);
      background:#ffffff;
      border-radius:999px;
      font-weight:600;
      font-size:.75rem;
      cursor:pointer;
      white-space:nowrap;
      transition:all .16s ease;
    }
    .chip .emoji{font-size:.9rem}
    .chip:hover{
      background:var(--brand);
      color:#020817;
      transform:translateY(-1px);
      box-shadow:0 8px 18px rgba(15,23,42,.16);
    }

    .nav-item{position:relative;display:inline-flex;align-items:center}
    .nav-trigger{background:#fff;}

    .submenu{
      position:absolute;
      top:100%;
      left:0;
      margin-top:4px;
      padding:8px 8px;
      border-radius:16px;
      background:#ffffff;
      box-shadow:0 14px 32px rgba(15,23,42,.22);
      display:none;
      flex-direction:column;
      gap:2px;
      min-width:170px;
      z-index:200;
    }
    .submenu-item,
    .submenu-label{
      display:block;
      padding:6px 9px;
      border-radius:10px;
      font-size:.78rem;
      color:#111827;
      background:transparent;
      border:none;
      text-align:left;
      cursor:pointer;
      white-space:nowrap;
    }
    .submenu-item:hover{
      background:rgba(5,150,105,.08);
      color:#065f46;
    }
    .submenu-label{
      font-weight:700;
      font-size:.7rem;
      color:#6b7280;
      cursor:default;
    }
    .submenu-group{
      position:relative;
      margin-top:4px;
      padding-top:4px;
      border-top:1px solid rgba(148,163,253,.26);
    }
    .submenu-nested{
      position:absolute;
      top:0;
      left:100%;
      margin-left:6px;
      padding:6px;
      border-radius:14px;
      background:#ffffff;
      box-shadow:0 12px 26px rgba(15,23,42,.2);
      display:none;
      flex-direction:column;
      gap:2px;
      min-width:150px;
      z-index:210;
    }
    .submenu-group:hover .submenu-nested{display:flex;}
    .nav-item.open>.submenu{display:flex;}
    @media (hover:hover){
      .nav-item:hover>.submenu{display:flex;}
    }

    /* HEADER */
    .header{padding:36px 0 18px}
    .title{
      margin:0;
      font-size:clamp(28px,5.6vw,44px);
      line-height:1.08;
      background:linear-gradient(135deg,#059669,#65a30d,#065f46);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    .subtitle{margin:.35rem 0 0;color:#64748b}

    /* GRID & CARDS */
    .posts-grid{display:grid;grid-template-columns:1fr;gap:1rem}
    @media (min-width:640px){.posts-grid{grid-template-columns:repeat(2,1fr)}}
    @media (min-width:980px){.posts-grid{grid-template-columns:repeat(3,1fr)}}
    .card{
      border-radius:24px;
      background:rgba(255,255,255,.9);
      border:1px solid rgba(15,23,42,.06);
      box-shadow:0 20px 50px -12px rgba(0,0,0,.15);
      overflow:hidden;
      transition:transform .14s ease,box-shadow .14s ease;
    }
    .card:hover{
      transform:translateY(-2px);
      box-shadow:0 24px 60px -18px rgba(15,23,42,.28);
    }
    .post-cover{
      height:144px;
      background:linear-gradient(135deg,rgba(16,185,129,.15),rgba(250,204,21,.15));
      background-size:cover;
      background-position:center;
    }

    /* PAGER */
    .pager{
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
      align-items:center;
      justify-content:center;
      margin:20px 0;
    }
    .pager a,.pager span{
      display:inline-flex;
      min-width:40px;
      height:40px;
      align-items:center;
      justify-content:center;
      padding:0 .75rem;
      border-radius:12px;
      border:1px solid rgba(15,23,42,.08);
      background:#fff;
      color:#0f172a;
      font-weight:700;
      font-size:.85rem;
    }
    .pager .active{
      background:var(--brand);
      color:#fff;
      border-color:transparent;
    }
    .pager .disabled{
      opacity:.45;
      pointer-events:none;
    }

    footer{
      border-top:1px solid rgba(15,23,42,.08);
      padding:24px 0;
      margin-top:40px;
      color:#64748b;
      font-size:.78rem;
    }
    footer .row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:1rem;
      flex-wrap:wrap;
    }

    .reveal{opacity:0;transform:translateY(16px);transition:opacity .5s ease,transform .5s ease}
    .reveal.in{opacity:1;transform:translateY(0)}

    /* ==== THEMES (igual que index, resumido) ==== */
    body[data-theme="oscuro"]{
      background:#020817;
      color:#e5e7eb;
    }
    body[data-theme="oscuro"] .nav{
      background:rgba(2,8,23,.98);
      border-bottom-color:rgba(148,163,253,.25);
      box-shadow:0 14px 40px rgba(0,0,0,.9);
    }
    body[data-theme="oscuro"] .brand-text{color:#e5e7eb;}
    body[data-theme="oscuro"] .chip{
      background:transparent;
      border-color:#22c55e;
      color:#bbf7d0;
    }
    body[data-theme="oscuro"] .chip:hover{
      background:#22c55e;
      color:#020817;
    }
    body[data-theme="oscuro"] .card{
      background:rgba(12,19,38,.98);
      border-color:rgba(148,163,253,.25);
      color:#e5e7eb;
    }
    body[data-theme="oscuro"] .post-cover{
      background:linear-gradient(135deg,#020817,#059669);
    }
    body[data-theme="oscuro"] footer{
      border-top-color:rgba(148,163,253,.25);
      color:#9ca3af;
    }

    body[data-theme="psycho"]{
      background:
        radial-gradient(circle at top,#22c55e1f,#020817),
        radial-gradient(circle at bottom,#a855f71f,transparent),
        #020817;
      color:#e5e7eb;
    }
    body[data-theme="psycho"] .nav{
      background:rgba(6,6,20,.98);
      border-bottom-color:#a855f7;
      box-shadow:0 16px 50px rgba(0,0,0,.9);
    }
    body[data-theme="psycho"] .brand-text{color:#f9fafb;}
    body[data-theme="psycho"] .chip{
      border-color:#22c55e;
      color:#bbf7d0;
      background:rgba(6,8,24,.98);
    }
    body[data-theme="psycho"] .chip:hover{
      background:linear-gradient(90deg,#22c55e,#a855f7,#22d3ee);
      color:#020817;
    }
    body[data-theme="psycho"] .card{
      background:rgba(6,8,24,.98);
      border-color:rgba(168,85,247,.4);
      box-shadow:0 22px 60px rgba(0,0,0,1);
      color:#e5e7eb;
    }
    body[data-theme="psycho"] .post-cover{
      background:linear-gradient(135deg,#22c55e,#a855f7,#22d3ee);
    }

    body[data-theme="comunitario"]{
      background:
        radial-gradient(circle at 0 0,rgba(254,252,232,1),transparent),
        radial-gradient(circle at 100% 0,rgba(220,252,231,.95),transparent),
        radial-gradient(circle at 0 100%,rgba(254,249,195,.95),transparent),
        #fefce8;
      color:#1f2937;
    }
    body[data-theme="comunitario"] .nav{
      background:rgba(255,255,255,.98);
      border-bottom-color:rgba(234,179,8,.6);
      box-shadow:0 14px 40px rgba(180,83,9,.18);
    }
    body[data-theme="comunitario"] .brand-text{color:#15803d;}
    body[data-theme="comunitario"] .chip{
      border-color:#22c55e;
      color:#166534;
      background:rgba(255,255,255,.98);
    }
    body[data-theme="comunitario"] .chip:hover{
      background:linear-gradient(90deg,rgba(22,163,74,.18),rgba(249,115,22,.08));
      color:#14532d;
    }
    body[data-theme="comunitario"] .card{
      background:rgba(255,255,255,.98);
      border-color:rgba(22,163,74,.22);
      box-shadow:0 22px 55px rgba(146,64,14,.16);
    }
    body[data-theme="comunitario"] .post-cover{
      background:linear-gradient(135deg,rgba(22,163,74,.4),rgba(245,158,11,.26));
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav" id="mainNav">
    <div class="container row">
      <a class="brand" href="index.html">
        <img src="images/logo_transparente.png" alt="Guardianes del Pulque" class="brand-logo">
        <span class="brand-text">Guardianes del Pulque</span>
      </a>
      <div class="links">
        <!-- Comunidad -->
        <div class="nav-item nav-comunidad">
          <button class="chip nav-trigger" type="button">Comunidad â–¾</button>
          <div class="submenu">
            <a class="submenu-item" href="index.html#bioalkimia">QuiÃ©nes somos</a>
            <a class="submenu-item" href="index.html#aliados">Aliados</a>
            <div class="submenu-group">
              <span class="submenu-label">Patrocinadores â–¸</span>
              <div class="submenu submenu-nested">
                <a class="submenu-item" href="https://teomatisacredcopal.com/" target="_blank" rel="noopener">Teomati</a>
              </div>
            </div>
          </div>
        </div>

        <!-- ArtÃ­culos -->
        <a class="chip" href="posts.html">ArtÃ­culos</a>

        <!-- Donar -->
        <a class="chip" href="index.html#donar"><span class="emoji">ðŸ’š</span> Donar</a>

        <!-- Modo -->
        <div class="nav-item nav-mode">
          <button class="chip nav-trigger" id="modeToggle" type="button">Modo â–¾</button>
          <div class="submenu submenu-mode" id="modeMenu">
            <button class="submenu-item" data-theme="default" type="button">ClÃ¡sico</button>
            <button class="submenu-item" data-theme="oscuro" type="button">Modo oscuro</button>
            <button class="submenu-item" data-theme="psycho" type="button">Modo psychodÃ©lico</button>
            <button class="submenu-item" data-theme="comunitario" type="button">Modo comunitario</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- HEADER -->
  <header class="container header">
    <h1 class="title">Todos los artÃ­culos</h1>
    <p class="subtitle">Pulque, tierra y maguey â€” listado completo con paginaciÃ³n.</p>
  </header>

  <!-- GRID -->
  <main class="container">
    <div id="status" style="margin:6px 0 12px;font-size:12px;color:#64748b"></div>
    <div class="posts-grid" id="postsGrid"></div>
    <nav class="pager" id="pager"></nav>
  </main>

  <!-- FOOTER -->
  <footer>
    <div class="container row">
      <div style="display:flex;align-items:center;gap:.4rem">
        <img src="images/logo_transparente.png" alt="Guardianes del Pulque" style="height:22px;width:auto">
        <span>Guardianes del Pulque</span>
      </div>
      <div style="display:flex;gap:.35rem;flex-wrap:wrap">
        <a class="chip" href="index.html">Inicio</a>
        <a class="chip" href="index.html#donar"><span class="emoji">ðŸ’š</span> Donar</a>
        <a class="chip" href="index.html#bioalkimia">Comunidad</a>
      </div>
    </div>
  </footer>

  <script type="application/json" id="posts-fallback">[]</script>

  <script>
    // THEME init
    (function(){
      const saved = localStorage.getItem('gp.theme');
      if(saved && saved!=='default'){
        document.body.setAttribute('data-theme', saved);
      }
    })();

    // NAV dropdowns
    (function(){
      const comunidadItem = document.querySelector('.nav-comunidad');
      const modeItem = document.querySelector('.nav-mode');
      const modeMenu = document.getElementById('modeMenu');

      function closeAll(){
        comunidadItem && comunidadItem.classList.remove('open');
        modeItem && modeItem.classList.remove('open');
      }

      if(comunidadItem){
        const btn = comunidadItem.querySelector('.nav-trigger');
        btn.addEventListener('click',(e)=>{
          e.preventDefault();
          e.stopPropagation();
          const open = comunidadItem.classList.contains('open');
          closeAll();
          if(!open) comunidadItem.classList.add('open');
        });
      }

      if(modeItem && modeMenu){
        const btn = document.getElementById('modeToggle');
        btn.addEventListener('click',(e)=>{
          e.preventDefault();
          e.stopPropagation();
          const open = modeItem.classList.contains('open');
          closeAll();
          if(!open) modeItem.classList.add('open');
        });

        modeMenu.querySelectorAll('[data-theme]').forEach(opt=>{
          opt.addEventListener('click', ()=>{
            const t = opt.dataset.theme;
            if(t === 'default'){
              document.body.removeAttribute('data-theme');
              localStorage.removeItem('gp.theme');
            }else{
              document.body.setAttribute('data-theme', t);
              localStorage.setItem('gp.theme', t);
            }
            closeAll();
          });
        });
      }

      document.addEventListener('click',(e)=>{
        if(!e.target.closest('.nav-item')) closeAll();
      });
    })();

    // Reveal
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.classList.add('in');
          io.unobserve(e.target);
        }
      });
    }, {threshold:.2});

    function escapeHtml(s){
      return String(s).replace(/[&<>"]/g, m=>({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'
      }[m]));
    }
    function qsNum(name, def){
      const v = parseInt(new URL(location.href).searchParams.get(name)||def,10);
      return Number.isFinite(v)&&v>0 ? v : def;
    }

    function candidateUrls(filename){
      const ts = Date.now();
      const origin = location.origin;
      const path = location.pathname;
      const dir = path.replace(/[^\/]*$/,'');
      const segs = path.split('/').filter(Boolean);
      const repoBase = segs.length ? `/${segs[0]}/` : '/';
      return [
        `${origin}${dir}${filename}?v=${ts}`,
        `${origin}${repoBase}${filename}?v=${ts}`,
        `${origin}/${filename}?v=${ts}`
      ].filter((v,i,a)=>a.indexOf(v)===i);
    }

    async function fetchJsonSmart(filename){
      const tries = candidateUrls(filename);
      const status = document.getElementById('status');
      const traces = [];
      for(const url of tries){
        try{
          const r = await fetch(url,{cache:'no-store'});
          traces.push(`GET ${url} â†’ ${r.status}`);
          if(r.ok) return await r.json();
        }catch(e){
          traces.push(`ERR ${url} â†’ ${e}`);
        }
      }
      if(status){
        status.textContent = (location.protocol==='file:'
          ? 'Abre con Live Server (fetch se bloquea con file://).'
          : 'No se encontrÃ³ posts.json. ColÃ³calo junto a posts.html en GitHub Pages.');
      }
      console.warn(traces.join('\n'));
      throw new Error('posts.json no encontrado');
    }

    function makeCard(p){
      const el=document.createElement('article');
      el.className='card reveal';
      el.style.overflow='hidden';
      const coverStyle = p.cover
        ? `style="background-image:url('${p.cover}');background-size:cover;background-position:center"`
        : '';
      el.innerHTML = `
        <div class="post-cover" ${coverStyle}></div>
        <div style="padding:16px">
          <div style="font-size:12px;color:var(--brand)">${escapeHtml(p.tag||'')}</div>
          <h3 style="margin:.2rem 0;font-size:1rem">${escapeHtml(p.title||'')}</h3>
          <p style="color:#475569">${escapeHtml(p.excerpt||'')}</p>
          <div style="padding-top:6px">
            <a class="chip" href="${p.url||'#'}">Leer â†’</a>
          </div>
        </div>`;
      io.observe(el);
      return el;
    }

    function renderPage(items,page,perPage){
      const grid=document.getElementById('postsGrid');
      const pager=document.getElementById('pager');
      grid.innerHTML=''; pager.innerHTML='';

      if(!items.length){
        grid.innerHTML='<p class="muted">AÃºn no hay artÃ­culos publicados.</p>';
        return;
      }
      const total=items.length;
      const pages=Math.max(1,Math.ceil(total/perPage));
      page=Math.min(Math.max(1,page),pages);
      const start=(page-1)*perPage;
      const end=Math.min(start+perPage,total);

      items.slice(start,end).forEach(p=>grid.appendChild(makeCard(p)));

      function link(n,label,cls){
        const a=document.createElement('a');
        a.href=`?page=${n}`;
        a.textContent=label;
        if(cls)a.classList.add(cls);
        return a;
      }
      function span(label,cls){
        const s=document.createElement('span');
        s.textContent=label;
        if(cls)s.classList.add(cls);
        return s;
      }

      pager.appendChild(page>1 ? link(page-1,'â€¹') : span('â€¹','disabled'));
      for(let i=1;i<=pages;i++){
        pager.appendChild(i===page ? span(String(i),'active') : link(i,String(i)));
      }
      pager.appendChild(page<pages ? link(page+1,'â€º') : span('â€º','disabled'));
    }

    (async function(){
      const PER_PAGE=9;
      const page=qsNum('page',1);
      const status=document.getElementById('status');
      let posts=[];
      try{
        const data=await fetchJsonSmart('posts.json');
        posts = Array.isArray(data)?data:(Array.isArray(data.entries)?data.entries:[]);
        if(status) status.textContent='';
      }catch(_){
        try{ posts=JSON.parse(document.getElementById('posts-fallback').textContent||'[]'); }catch{}
        if(status && !posts.length){
          status.textContent=(location.protocol==='file:'
            ? 'Abre con Live Server para que fetch funcione.'
            : 'Sube posts.json junto a posts.html en GitHub Pages.');
        }
      }
      renderPage(posts,page,PER_PAGE);
    })();
  </script>
</body>
</html>
