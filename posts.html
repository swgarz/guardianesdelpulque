<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Todos los art√≠culos ‚Äî Guardianes del Pulque</title>
  <meta name="description" content="Listado completo de art√≠culos: pulque, tierra y maguey." />
  <style>
    *,*::before,*::after{box-sizing:border-box}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,'Helvetica Neue',Arial,'Apple Color Emoji','Segoe UI Emoji';
      line-height:1.5;
      color:#0f172a;
      background:#f6f8fb;
      transition:background .25s ease,color .25s ease;
    }
    :root{--brand:#059669;--ink:#0f172a;--muted:#475569;--card:#ffffff;--stroke:#e5e7eb;}
    a{color:inherit;text-decoration:none}

    .container{max-width:1180px;margin-inline:auto;padding:0 16px}
    @media (min-width:640px){.container{padding:0 24px}}

    /* NAV (igual que index) */
    .nav{
      position:sticky;top:0;z-index:80;
      background:rgba(255,255,255,.96);
      backdrop-filter:saturate(180%) blur(14px);
      border-bottom:1px solid rgba(15,23,42,.06);
      transition:background .25s ease,border-color .25s ease,box-shadow .25s ease;
    }
    .nav .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:8px 0;
      gap:.75rem;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:.45rem;
      font-weight:700;
      flex-shrink:0;
    }
    .brand-logo{height:36px;width:auto}
    @media (min-width:768px){.brand-logo{height:44px}}
    .brand-text{font-size:.96rem;letter-spacing:.02em;}

    .links{
      display:flex;
      flex-wrap:wrap;
      gap:.4rem;
      align-items:center;
      justify-content:flex-end;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      padding:.4rem .8rem;
      border-radius:999px;
      border:1.5px solid var(--brand);
      font-size:.75rem;
      font-weight:600;
      color:var(--brand);
      background:#ffffff;
      cursor:pointer;
      transition:all .16s ease;
      white-space:nowrap;
    }
    .chip:hover{
      background:var(--brand);
      color:#020817;
      box-shadow:0 8px 18px rgba(15,23,42,.16);
      transform:translateY(-1px);
    }

    .nav-item{position:relative;}
    .nav-trigger{border:0;background:none;padding:0;}
    .nav-trigger .chip{padding-right:1.1rem;}
    .nav-trigger .chip::after{
      content:"‚ñæ";
      font-size:.6rem;
    }

    .nav-dropdown{
      position:absolute;
      top:100%;
      left:0;
      margin-top:0;
      padding:6px 0;
      min-width:170px;
      background:#ffffff;
      border-radius:14px;
      box-shadow:0 14px 40px rgba(15,23,42,.18);
      border:1px solid rgba(148,163,253,.35);
      opacity:0;
      pointer-events:none;
      transition:opacity .16s ease;
      z-index:90;
    }
    .nav-dropdown-mode{
      right:0;
      left:auto;
      min-width:180px;
    }
    .nav-link{
      display:flex;
      align-items:center;
      width:100%;
      gap:.4rem;
      padding:6px 10px;
      font-size:.78rem;
      color:#0f172a;
      cursor:pointer;
      background:transparent;
      border:0;
      text-align:left;
      white-space:nowrap;
    }
    .nav-link:hover{
      background:rgba(5,150,105,.06);
      color:#065f46;
    }
    .nav-item-inline{position:relative;}
    .has-children::after{
      content:"‚ñ∏";
      font-size:.65rem;
      margin-left:auto;
      color:#9ca3af;
    }
    .nav-subdropdown{
      position:absolute;
      top:0;
      left:100%;
      margin-left:4px;
      padding:6px 0;
      min-width:150px;
      background:#ffffff;
      border-radius:14px;
      box-shadow:0 14px 40px rgba(15,23,42,.2);
      border:1px solid rgba(148,163,253,.35);
      opacity:0;
      pointer-events:none;
      z-index:95;
    }

    .nav-item:hover>.nav-dropdown,
    .nav-item:focus-within>.nav-dropdown,
    .nav-item.open>.nav-dropdown{
      opacity:1;
      pointer-events:auto;
    }
    .nav-item-inline:hover>.nav-subdropdown,
    .nav-item-inline:focus-within>.nav-subdropdown{
      opacity:1;
      pointer-events:auto;
    }
    .nav.scrolled{
      box-shadow:0 14px 40px rgba(15,23,42,.18);
      border-bottom-color:rgba(148,163,253,.32);
    }

    /* HEADER */
    .header{padding:36px 0 18px}
    .title{
      margin:0;
      font-size:clamp(28px,5.6vw,44px);
      line-height:1.08;
      background:linear-gradient(135deg,#059669,#65a30d,#065f46);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    .subtitle{margin:.35rem 0 0;color:#64748b}

    /* GRID & CARDS */
    .posts-grid{display:grid;grid-template-columns:1fr;gap:1rem}
    @media (min-width:640px){.posts-grid{grid-template-columns:repeat(2,1fr)}}
    @media (min-width:980px){.posts-grid{grid-template-columns:repeat(3,1fr)}}
    .card{
      border-radius:24px;
      background:rgba(255,255,255,.9);
      border:1px solid rgba(15,23,42,.06);
      box-shadow:0 20px 50px -12px rgba(0,0,0,.15);
      overflow:hidden;
      transition:transform .16s ease,box-shadow .16s ease;
    }
    .card:hover{
      transform:translateY(-3px);
      box-shadow:0 24px 60px -18px rgba(15,23,42,.26);
    }
    .post-cover{
      height:144px;
      background:linear-gradient(135deg,rgba(16,185,129,.15),rgba(250,204,21,.15));
      background-size:cover;
      background-position:center;
    }

    /* Paginaci√≥n */
    .pager{
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
      align-items:center;
      justify-content:center;
      margin:20px 0;
    }
    .pager a,.pager span{
      display:inline-flex;
      min-width:40px;
      height:40px;
      align-items:center;
      justify-content:center;
      padding:0 .75rem;
      border-radius:12px;
      border:1px solid rgba(15,23,42,.08);
      background:#fff;
      color:#0f172a;
      font-weight:700;
      font-size:.85rem;
    }
    .pager .active{
      background:var(--brand);
      color:#fff;
      border-color:transparent;
    }
    .pager .disabled{
      opacity:.45;
      pointer-events:none;
    }

    footer{
      border-top:1px solid rgba(15,23,42,.08);
      padding:24px 0;
      margin-top:40px;
      color:#64748b;
      font-size:.78rem;
    }
    footer .row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:1rem;
      flex-wrap:wrap;
    }

    .reveal{opacity:0;transform:translateY(16px);transition:opacity .5s ease,transform .5s ease}
    .reveal.in{opacity:1;transform:translateY(0)}

    /* MODO LECTURA */
    body.mode-reading{
      background:#020817;
      color:#e5e7eb;
    }
    body.mode-reading .nav{
      background:rgba(8,10,24,.98);
      border-bottom-color:rgba(129,140,248,.6);
      box-shadow:0 16px 40px rgba(0,0,0,.65);
    }
    body.mode-reading .brand-text{color:#e5e7eb;}
    body.mode-reading .title{
      background:linear-gradient(120deg,#22c55e,#a855f7,#22d3ee);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    body.mode-reading .card{
      background:rgba(10,15,30,.98);
      border-color:rgba(129,140,248,.5);
      box-shadow:0 22px 60px rgba(15,23,42,.85);
    }
    body.mode-reading .post-cover{
      background:
        radial-gradient(circle at 0 0,rgba(34,197,94,.35),transparent),
        radial-gradient(circle at 100% 0,rgba(236,72,153,.26),transparent);
    }
    body.mode-reading .chip{
      background:rgba(12,10,24,.98);
      color:#a5b4fc;
      border-color:#22c55e;
    }
    body.mode-reading .chip:hover{
      background:#22c55e;
      color:#020817;
    }

    /* MODO COMUNITARIO */
    body.mode-community{
      color:#f9fafb;
    }
    body.mode-community::before{
      content:"";
      position:fixed;
      inset:0;
      z-index:-1;
      background:
        radial-gradient(circle at 0 0,rgba(22,163,74,.32),transparent 60%),
        radial-gradient(circle at 100% 10%,rgba(8,47,73,.36),transparent 55%),
        radial-gradient(circle at 15% 100%,rgba(180,83,9,.32),transparent 55%),
        radial-gradient(circle at 100% 100%,rgba(147,51,234,.26),transparent 55%),
        #020817;
    }
    body.mode-community .nav{
      background:rgba(2,6,23,.97);
      border-bottom-color:rgba(34,197,94,.7);
      box-shadow:0 24px 80px rgba(0,0,0,.95);
    }
    body.mode-community .brand-text{color:#bbf7d0;}
    body.mode-community .chip{
      border-color:rgba(22,163,74,.95);
      color:#bbf7d0;
      background:rgba(0,0,0,.32);
      box-shadow:0 10px 26px rgba(0,0,0,.9);
    }
    body.mode-community .chip:hover{
      background:#22c55e;
      color:#020817;
    }
    body.mode-community .title{
      background:linear-gradient(135deg,#bbf7d0,#22c55e,#fde68a);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    body.mode-community .card{
      background:rgba(5,15,20,.97);
      border-color:rgba(22,163,74,.85);
      box-shadow:0 30px 90px rgba(0,0,0,1);
    }
    body.mode-community .post-cover{
      background:linear-gradient(135deg,rgba(16,185,129,.6),rgba(245,158,11,.45));
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav" id="mainNav">
    <div class="container row">
      <a class="brand" href="index.html">
        <img src="images/logo_transparente.png" alt="Guardianes del Pulque" class="brand-logo">
        <span class="brand-text">Guardianes del Pulque</span>
      </a>
      <div class="links">
        <!-- Comunidad -->
        <div class="nav-item">
          <button class="nav-trigger" type="button">
            <span class="chip">Comunidad</span>
          </button>
          <div class="nav-dropdown">
            <a class="nav-link" href="posts.html">Art√≠culos</a>
            <a class="nav-link" href="index.html#donar">Donar</a>
            <a class="nav-link" href="index.html#bioalkimia">Bioalkimia</a>
            <div class="nav-item-inline">
              <div class="nav-link has-children" tabindex="0">Patrocinadores</div>
              <div class="nav-subdropdown">
                <a class="nav-link" href="https://teomatisacredcopal.com/" target="_blank" rel="noopener">Teomati</a>
              </div>
            </div>
            <a class="nav-link" href="index.html#aliados">Aliados (pr√≥ximamente)</a>
          </div>
        </div>
        <!-- Modo -->
        <div class="nav-item">
          <button class="nav-trigger" type="button">
            <span class="chip">Modo</span>
          </button>
          <div class="nav-dropdown nav-dropdown-mode">
            <button class="nav-link js-mode" data-mode="base" type="button">Modo base</button>
            <button class="nav-link js-mode" data-mode="reading" type="button">Modo lectura</button>
            <button class="nav-link js-mode" data-mode="community" type="button">Modo comunitario</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- HEADER -->
  <header class="container header">
    <h1 class="title">Todos los art√≠culos</h1>
    <p class="subtitle">Pulque, tierra y maguey ‚Äî listado completo con paginaci√≥n.</p>
  </header>

  <!-- GRID -->
  <main class="container">
    <div id="status" style="margin:6px 0 12px;font-size:12px;color:#64748b"></div>
    <div class="posts-grid" id="postsGrid"></div>
    <nav class="pager" id="pager"></nav>
  </main>

  <footer>
    <div class="container row">
      <div style="display:flex;align-items:center;gap:.5rem">
        <img src="images/logo_transparente.png" alt="Guardianes del Pulque" style="height:22px;width:auto">
        <span>Pulque Vivo</span>
      </div>
      <div class="links">
        <a class="chip" href="index.html">Inicio</a>
        <a class="chip" href="index.html#donar"><span class="emoji">üíö</span> Donar</a>
        <a class="chip" href="index.html#bioalkimia">Bioalkimia</a>
      </div>
    </div>
  </footer>

  <script type="application/json" id="posts-fallback">[]</script>

  <script>
    // NAV scroll
    (function(){
      const nav = document.getElementById('mainNav');
      if(!nav) return;
      function update(){
        if(window.scrollY > 10) nav.classList.add('scrolled');
        else nav.classList.remove('scrolled');
      }
      update();
      window.addEventListener('scroll', update, {passive:true});
    })();

    // Reveal
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.classList.add('in');
          io.unobserve(e.target);
        }
      });
    }, {threshold:.2});

    function escapeHtml(s){
      return String(s).replace(/[&<>"]/g, m => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'
      }[m]));
    }

    function qsNum(name, def){
      const v = parseInt(new URL(location.href).searchParams.get(name) || def, 10);
      return Number.isFinite(v) && v > 0 ? v : def;
    }

    function candidateUrls(filename){
      const ts = Date.now();
      const origin = location.origin;
      const path = location.pathname;
      const dir = path.replace(/[^\/]*$/,'');
      const segs = path.split('/').filter(Boolean);
      const repoBase = segs.length ? `/${segs[0]}/` : '/';
      return [
        `${origin}${dir}${filename}?v=${ts}`,
        `${origin}${repoBase}${filename}?v=${ts}`,
        `${origin}/${filename}?v=${ts}`
      ].filter((v,i,a)=>a.indexOf(v)===i);
    }

    async function fetchJsonSmart(filename){
      const tries = candidateUrls(filename);
      const status = document.getElementById('status');
      const traces = [];
      for(const url of tries){
        try{
          const r = await fetch(url,{cache:'no-store'});
          traces.push(`GET ${url} ‚Üí ${r.status}`);
          if(r.ok) return await r.json();
        }catch(e){
          traces.push(`ERR ${url} ‚Üí ${e}`);
        }
      }
      if(status){
        status.textContent = (location.protocol === 'file:'
          ? 'Abre con Live Server (fetch se bloquea con file://).'
          : 'No se encontr√≥ posts.json. Col√≥calo junto a posts.html en GitHub Pages.');
      }
      console.warn('posts.json no encontrado:\n'+traces.join('\n'));
      throw new Error('posts.json no encontrado');
    }

    function makeCard(p){
      const el = document.createElement('article');
      el.className = 'card reveal';
      el.style.overflow = 'hidden';
      const coverStyle = p.cover
        ? `style="background-image:url('${p.cover}');background-size:cover;background-position:center"`
        : '';
      el.innerHTML = `
        <div class="post-cover" ${coverStyle}></div>
        <div style="padding:16px">
          <div style="font-size:12px;color:var(--brand)">${escapeHtml(p.tag || '')}</div>
          <h3 style="margin:.2rem 0;font-size:1rem">${escapeHtml(p.title || '')}</h3>
          <p style="color:#475569">${escapeHtml(p.excerpt || '')}</p>
          <div style="padding-top:6px">
            <a class="chip" href="${p.url || '#'}">Leer ‚Üí</a>
          </div>
        </div>
      `;
      io.observe(el);
      return el;
    }

    function renderPage(items,page,perPage){
      const grid = document.getElementById('postsGrid');
      const pager = document.getElementById('pager');
      grid.innerHTML = '';
      pager.innerHTML = '';

      if(!items.length){
        grid.innerHTML = '<p class="muted">A√∫n no hay art√≠culos publicados.</p>';
        return;
      }

      const total = items.length;
      const pages = Math.max(1, Math.ceil(total / perPage));
      page = Math.min(Math.max(1, page), pages);
      const start = (page - 1) * perPage;
      const end = Math.min(start + perPage, total);

      items.slice(start, end).forEach(p => grid.appendChild(makeCard(p)));

      function link(n,label,cls){
        const a = document.createElement('a');
        a.href = `?page=${n}`;
        a.textContent = label;
        if(cls) a.classList.add(cls);
        return a;
      }
      function span(label,cls){
        const s = document.createElement('span');
        s.textContent = label;
        if(cls) s.classList.add(cls);
        return s;
      }

      pager.appendChild(page > 1 ? link(page-1,'‚Äπ') : span('‚Äπ','disabled'));
      for(let i=1;i<=pages;i++){
        pager.appendChild(i===page ? span(String(i),'active') : link(i,String(i)));
      }
      pager.appendChild(page < pages ? link(page+1,'‚Ä∫') : span('‚Ä∫','disabled'));
    }

    (async function(){
      const PER_PAGE = 9;
      const page = qsNum('page',1);
      let posts = [];
      try{
        const data = await fetchJsonSmart('posts.json');
        posts = Array.isArray(data) ? data : (Array.isArray(data.entries) ? data.entries : []);
        const status = document.getElementById('status');
        if(status) status.textContent = '';
      }catch(_){
        try{
          posts = JSON.parse(document.getElementById('posts-fallback').textContent || '[]');
        }catch{}
      }
      renderPage(posts,page,PER_PAGE);
    })();

    // Modo visual
    (function(){
      const KEY = 'gp.mode';
      const body = document.body;
      function apply(mode){
        body.classList.remove('mode-reading','mode-community');
        if(mode === 'reading') body.classList.add('mode-reading');
        else if(mode === 'community') body.classList.add('mode-community');
      }
      try{
        const saved = localStorage.getItem(KEY);
        if(saved) apply(saved);
      }catch{}

      document.querySelectorAll('.js-mode').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const m = btn.dataset.mode;
          if(m === 'base'){
            apply(null);
            try{localStorage.removeItem(KEY);}catch{}
          }else{
            apply(m);
            try{localStorage.setItem(KEY,m);}catch{}
          }
        });
      });
    })();

    // Dropdown por click (m√≥vil)
    (function(){
      const items = document.querySelectorAll('.nav-item');
      document.querySelectorAll('.nav-trigger').forEach(btn=>{
        btn.addEventListener('click',e=>{
          const item = btn.closest('.nav-item');
          if(!item) return;
          const open = !item.classList.contains('open');
          items.forEach(i=>i.classList.remove('open'));
          if(open) item.classList.add('open');
          e.stopPropagation();
        });
      });
      document.addEventListener('click',e=>{
        if(!e.target.closest('.nav-item')){
          items.forEach(i=>i.classList.remove('open'));
        }
      });
    })();
  </script>
</body>
</html>
