<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Todos los art√≠culos ‚Äî Guardianes del Pulque</title>
  <meta name="description" content="Listado completo de art√≠culos: pulque, tierra y maguey." />
  <style>
    *,*::before,*::after{box-sizing:border-box}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,'Helvetica Neue',Arial,'Apple Color Emoji','Segoe UI Emoji';
      line-height:1.5;
      color:#0f172a;
      background:#f6f8fb;
    }
    :root{ --brand:#059669; --ink:#0f172a; --muted:#475569; --card:#ffffff; --stroke:#e5e7eb; }
    a{color:inherit;text-decoration:none}

    .container{max-width:1180px;margin-inline:auto;padding:0 16px}
    @media (min-width:640px){ .container{padding:0 24px} }

    /* NAV */
    .nav{
      position:sticky;top:0;z-index:50;
      background:transparent;
      border-bottom:1px solid transparent;
      backdrop-filter:saturate(180%) blur(14px);
      transition:background .25s ease,border-color .25s ease,box-shadow .25s ease;
    }
    .nav .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 0;
      gap:1rem;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:.5rem;
      font-weight:700;
    }
    .brand-logo{
      height:44px;
      width:auto;
      display:block;
    }
    @media (min-width:768px){ .brand-logo{height:58px;} }
    .brand-text{
      font-size:1rem;
      color:#111827;
      letter-spacing:.02em;
    }
    .links{
      display:flex;
      align-items:center;
      gap:.5rem;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:.45rem;
      padding:.5rem .9rem;
      border:2px solid var(--brand);
      color:var(--brand);
      background:rgba(255,255,255,.98);
      border-radius:999px;
      font-weight:700;
      font-size:.8rem;
      white-space:nowrap;
      cursor:pointer;
      transition:background .18s ease,color .18s ease,transform .12s ease,border-color .18s ease;
      position:relative;
      z-index:55;
    }
    .chip .emoji{font-size:1rem}
    .chip:hover{
      background:var(--brand);
      color:#020817;
      transform:translateY(-1px);
    }

    /* Comunidad dropdown (igual que index) */
    .chip-dropdown{
      padding-right:1.6rem;
      user-select:none;
      transform:none !important;
    }
    .chip-dropdown::after{
      content:'';
      position:absolute;
      right:.6rem;
      top:50%;
      width:0;
      height:0;
      border-left:4px solid transparent;
      border-right:4px solid transparent;
      border-top:5px solid var(--brand);
      transform:translateY(-40%);
      pointer-events:none;
    }
    .chip-dropdown .dropdown{
      position:absolute;
      top:100%;
      left:0;
      margin-top:-1px;
      background:#020817;
      border-radius:16px;
      padding:.35rem 0;
      border:1px solid rgba(34,197,94,.35);
      box-shadow:0 18px 40px rgba(0,0,0,.45);
      display:none;
      min-width:220px;
      z-index:60;
    }
    .chip-dropdown .dropdown a,
    .chip-dropdown .dropdown .item > a{
      display:flex;
      align-items:center;
      gap:.35rem;
      padding:.45rem .9rem;
      font-size:.78rem;
      color:#bbf7d0;
      text-decoration:none;
    }
    .chip-dropdown .dropdown a span,
    .chip-dropdown .dropdown .item > a span{
      font-size:.9rem;
    }
    .chip-dropdown .dropdown a:hover,
    .chip-dropdown .dropdown .item > a:hover{
      background:rgba(34,197,94,.16);
      color:#22c55e;
    }
    .chip-dropdown .dropdown .item{
      position:relative;
    }
    .chip-dropdown .dropdown .item-label{
      display:flex;
      align-items:center;
      gap:.35rem;
      padding:.45rem .9rem;
      font-size:.78rem;
      color:#bbf7d0;
      cursor:pointer;
    }
    .chip-dropdown .dropdown .item-label span.icon{
      font-size:.9rem;
    }
    .chip-dropdown .dropdown .item-label span.caret{
      margin-left:auto;
      font-size:.6rem;
      opacity:.8;
    }
    .chip-dropdown .dropdown .item-label:hover{
      background:rgba(34,197,94,.16);
      color:#22c55e;
    }
    .chip-dropdown .dropdown .submenu{
      position:absolute;
      top:0;
      left:100%;
      margin-left:-1px;
      background:#020817;
      border-radius:14px;
      padding:.3rem 0;
      border:1px solid rgba(34,197,94,.35);
      box-shadow:0 18px 40px rgba(0,0,0,.6);
      display:none;
      min-width:170px;
      z-index:70;
    }
    .chip-dropdown .dropdown .submenu a{
      padding:.4rem .75rem;
      font-size:.76rem;
      color:#bbf7d0;
    }
    .chip-dropdown .dropdown .submenu a:hover{
      background:rgba(34,197,94,.18);
      color:#22c55e;
    }
    .chip-dropdown:hover,
    .chip-dropdown:focus-within{
      background:var(--brand);
      color:#020817;
    }
    .chip-dropdown:hover::after,
    .chip-dropdown:focus-within::after{
      border-top-color:#020817;
    }
    .chip-dropdown:hover .dropdown,
    .chip-dropdown:focus-within .dropdown{
      display:block;
    }
    .chip-dropdown .dropdown .item:hover .submenu,
    .chip-dropdown .dropdown .item:focus-within .submenu{
      display:block;
    }

    .nav.scrolled{
      background:#020817;
      border-bottom-color:rgba(148,163,253,.18);
      box-shadow:0 14px 40px rgba(0,0,0,.55);
    }
    .nav.scrolled .brand-text{color:#f9fafb;}
    .nav.scrolled .chip{
      background:transparent;
      border-color:#22c55e;
      color:#bbf7d0;
      transform:none;
    }
    .nav.scrolled .chip:hover{
      background:#22c55e;
      color:#020817;
    }
    .nav.scrolled .chip-dropdown::after{
      border-top-color:#22c55e;
    }

    /* Header */
    .header{padding:36px 0 18px}
    .title{
      margin:0;
      font-size:clamp(28px,5.6vw,44px);
      line-height:1.08;
      background:linear-gradient(135deg,#059669,#65a30d,#065f46);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    .subtitle{margin:.35rem 0 0;color:#64748b}

    /* Grid & cards */
    .posts-grid{display:grid;grid-template-columns:1fr;gap:1rem}
    @media (min-width:640px){.posts-grid{grid-template-columns:repeat(2,1fr)}}
    @media (min-width:980px){.posts-grid{grid-template-columns:repeat(3,1fr)}}
    .card{
      border-radius:24px;
      background:rgba(255,255,255,.9);
      border:1px solid rgba(15,23,42,.06);
      box-shadow:0 20px 50px -12px rgba(0,0,0,.15);
      overflow:hidden;
    }
    .post-cover{
      height:144px;
      background:linear-gradient(135deg,rgba(16,185,129,.15),rgba(250,204,21,.15));
    }

    /* Paginaci√≥n */
    .pager{
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
      align-items:center;
      justify-content:center;
      margin:20px 0;
    }
    .pager a,.pager span{
      display:inline-flex;
      min-width:40px;
      height:40px;
      align-items:center;
      justify-content:center;
      padding:0 .75rem;
      border-radius:12px;
      border:1px solid rgba(15,23,42,.08);
      background:#fff;
      color:#0f172a;
      font-weight:700;
      font-size:.85rem;
    }
    .pager .active{
      background:var(--brand);
      color:#fff;
      border-color:transparent;
    }
    .pager .disabled{
      opacity:.45;
      pointer-events:none;
    }

    footer{
      border-top:1px solid rgba(15,23,42,.08);
      padding:24px 0;
      margin-top:40px;
      color:#64748b;
    }

    .reveal{opacity:0;transform:translateY(16px);transition:opacity .5s ease,transform .5s ease}
    .reveal.in{opacity:1;transform:translateY(0)}
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav" id="mainNav">
    <div class="container row">
      <a class="brand" href="index.html">
        <img src="images/logo_transparente.png" alt="Guardianes del Pulque" class="brand-logo">
        <span class="brand-text">Guardianes del Pulque</span>
      </a>
      <div class="links">
        <a class="chip" href="index.html">Inicio</a>
        <a class="chip" href="index.html#donar"><span class="emoji">üíö</span> Donar</a>
        <div class="chip chip-dropdown">
          Comunidad
          <div class="dropdown">
            <div class="item">
              <div class="item-label">
                <span class="icon">üíº</span> Patrocinadores
                <span class="caret">‚ñ∏</span>
              </div>
              <div class="submenu">
                <a href="https://teomatisacredcopal.com/" target="_blank" rel="noopener">Teomati</a>
              </div>
            </div>
            <a href="alianzas.html">
              <span>ü§ù</span> Aliados
            </a>
            <a href="colabora.html">
              <span>‚ú®</span> Quiero colaborar
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- HEADER -->
  <header class="container header">
    <h1 class="title">Todos los art√≠culos</h1>
    <p class="subtitle">Pulque, tierra y maguey ‚Äî listado completo con paginaci√≥n.</p>
  </header>

  <!-- GRID -->
  <main class="container">
    <div id="status" style="margin:6px 0 12px;font-size:12px;color:#64748b"></div>
    <div class="posts-grid" id="postsGrid"></div>
    <nav class="pager" id="pager"></nav>
  </main>

  <footer>
    <div class="container" style="display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap">
      <div style="display:flex;align-items:center;gap:.5rem">
        <img src="images/logo_transparente.png" alt="Guardianes del Pulque" style="height:26px;width:auto">
        <span>Pulque Vivo</span>
      </div>
      <div class="links">
        <a class="chip" href="index.html">Inicio</a>
        <a class="chip" href="index.html#donar"><span class="emoji">üíö</span> Donar</a>
        <a class="chip" href="index.html#bioalkimia">Bioalkimia</a>
      </div>
    </div>
  </footer>

  <script type="application/json" id="posts-fallback">[]</script>

  <script>
    // NAV scroll
    (function(){
      const nav = document.getElementById('mainNav');
      if(!nav) return;
      function update(){
        if(window.scrollY > 10) nav.classList.add('scrolled');
        else nav.classList.remove('scrolled');
      }
      update();
      window.addEventListener('scroll', update, {passive:true});
    })();

    // Reveal
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.classList.add('in');
          io.unobserve(e.target);
        }
      });
    }, {threshold:.2});

    function escapeHtml(s){
      return String(s).replace(/[&<>"]/g, m => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'
      }[m]));
    }

    function qsNum(name, def){
      const v = parseInt(new URL(location.href).searchParams.get(name) || def, 10);
      return Number.isFinite(v) && v > 0 ? v : def;
    }

    function candidateUrls(filename){
      const ts = Date.now();
      const origin = location.origin;
      const path = location.pathname;
      const dir = path.replace(/[^\/]*$/,'');
      const segs = path.split('/').filter(Boolean);
      const repoBase = segs.length ? `/${segs[0]}/` : '/';
      return [
        `${origin}${dir}${filename}?v=${ts}`,
        `${origin}${repoBase}${filename}?v=${ts}`,
        `${origin}/${filename}?v=${ts}`
      ].filter((v,i,a)=>a.indexOf(v)===i);
    }

    async function fetchJsonSmart(filename){
      const tries = candidateUrls(filename);
      const status = document.getElementById('status');
      const traces = [];
      for(const url of tries){
        try{
          const r = await fetch(url, {cache:'no-store'});
          traces.push(`GET ${url} ‚Üí ${r.status}`);
          if(r.ok) return await r.json();
        }catch(e){
          traces.push(`ERR ${url} ‚Üí ${e}`);
        }
      }
      if(status){
        status.textContent = (location.protocol === 'file:'
          ? 'Abre con Live Server (fetch se bloquea con file://).'
          : 'No se encontr√≥ posts.json. Col√≥calo junto a posts.html en GitHub Pages.');
      }
      console.warn('posts.json no encontrado:\n'+traces.join('\n'));
      throw new Error('posts.json no encontrado');
    }

    function makeCard(p){
      const el = document.createElement('article');
      el.className = 'card reveal';
      el.style.overflow = 'hidden';

      const coverStyle = p.cover
        ? `style="background-image:url('${p.cover}');background-size:cover;background-position:center"`
        : '';

      el.innerHTML = `
        <div class="post-cover" ${coverStyle}></div>
        <div style="padding:16px">
          <div style="font-size:12px;color:var(--brand)">${escapeHtml(p.tag || '')}</div>
          <h3 style="margin:.2rem 0;font-size:1rem">${escapeHtml(p.title || '')}</h3>
          <p style="color:#475569">${escapeHtml(p.excerpt || '')}</p>
          <div style="padding-top:6px">
            <a class="chip" href="${p.url || '#'}">Leer ‚Üí</a>
          </div>
        </div>
      `;
      io.observe(el);
      return el;
    }

    function renderPage(items, page, perPage){
      const grid = document.getElementById('postsGrid');
      const pager = document.getElementById('pager');
      grid.innerHTML = '';
      pager.innerHTML = '';

      if(!items.length){
        grid.innerHTML = '<p class="muted">A√∫n no hay art√≠culos publicados.</p>';
        return;
      }

      const total = items.length;
      const pages = Math.max(1, Math.ceil(total / perPage));
      page = Math.min(Math.max(1, page), pages);

      const start = (page - 1) * perPage;
      const end = Math.min(start + perPage, total);

      items.slice(start, end).forEach(p => grid.appendChild(makeCard(p)));

      function link(n, label, cls){
        const a = document.createElement('a');
        a.href = `?page=${n}`;
        a.textContent = label;
        if(cls) a.classList.add(cls);
        return a;
      }
      function span(label, cls){
        const s = document.createElement('span');
        s.textContent = label;
        if(cls) s.classList.add(cls);
        return s;
      }

      pager.appendChild(page > 1 ? link(page - 1, '‚Äπ') : span('‚Äπ','disabled'));
      for(let i = 1; i <= pages; i++){
        pager.appendChild(i === page ? span(String(i),'active') : link(i, String(i)));
      }
      pager.appendChild(page < pages ? link(page + 1, '‚Ä∫') : span('‚Ä∫','disabled'));
    }

    (async function(){
      const PER_PAGE = 9;
      const page = qsNum('page', 1);
      const status = document.getElementById('status');
      let posts = [];
      try{
        const data = await fetchJsonSmart('posts.json');
        posts = Array.isArray(data) ? data : (Array.isArray(data.entries) ? data.entries : []);
        if(status) status.textContent = '';
      }catch(_){
        try{
          posts = JSON.parse(document.getElementById('posts-fallback').textContent || '[]');
        }catch{}
        if(status && !posts.length){
          status.textContent = (location.protocol === 'file:'
            ? 'Abre con Live Server para que fetch funcione.'
            : 'Sube posts.json junto a posts.html en GitHub Pages.');
        }
      }
      renderPage(posts, page, PER_PAGE);
    })();
  </script>
</body>
</html>
